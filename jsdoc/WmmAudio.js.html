<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: WmmAudio.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: WmmAudio.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { initMediaMonetization, monetizeEvents, mediaRemoved } from '../wmm-utils/client/monetize.js'
import { initAudioOrVideo, setClass, initCssClasses, unloadMedia } from './videoAndAudio.js'
import { setUrl, bindNotifications } from './common.js'

/**
 * Creates a web monetized audio element &amp;lt;wmm-audio&amp;gt;&lt;br/>
 * Attributes:&lt;br/>
 * * src: audio file source; if full URL is used, the recipe verification will use the same host for verification.&lt;br/>
 * * paymentUrl: Payment pointer URL, can also include receipt service url.&lt;br/>
 * * skipVerification: if true, don't send receipts to backend for verifications.&lt;br/>
 */
class WmmAudio extends HTMLElement {
  /**
   * Synchronise wmm-audio elements *src* attribute
   * with inner audio -elements *src* attrubute.
   */
  get src() { return this.getAttribute('src') }
  set src(url) { setUrl(this, url) }

  get paymentUrl() { return this.getAttribute('paymentUrl') }
  set paymentUrl(url) { this.setAttribute('paymentUrl', url) }

  constructor () {
    super()
    this.attachShadow({ mode: 'open' })
    initAudioOrVideo(this, 'audio')
    bindNotifications(this)
  }

  /**
   * Initializes monetization and styles when component is inserted into DOM.
   */
  connectedCallback () {
    initMediaMonetization(this)
    initCssClasses(this)
    setClass(this, 'data-pending')
    setUrl(this, this.src)
  }

  /**
   * Stops monetization and disconnects the media stream
   * when component is removed from DOM.
   */
   disconnectedCallback () {
    mediaRemoved(this)
    unloadMedia(this.shadowRoot.querySelector('audio'))
  }

  /**
   * Event listener for monetization and video events.
   * Binding to monetization events ('monetizationStopped', 'monetized', 'monetizeFailed')
   * allows tracking of monetization state, while all other events are passed
   * to the inner &amp;lt;audio&amp;gt; element and can be used to track the state of the media.
   * E.g. https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events
   * @param {string} name - Event name
   * @param {function} action - The action to execute on event.
   */
  addEventListener(name, action) {
    if (monetizeEvents.has(name)) {
      super.addEventListener(name, action)
    } else {
      this.media.addEventListener(name, action)
    }
  }

  /**
   * Remove monetization or video element listener
   * @param {string} name - Event name
   * @param {function} action - The action to execute on event.
   */
  removeEventListener(name, action) {
    if (monetizeEvents.has(name)) {
      super.removeEventListener(name, action)
    } else {
      this.media.removeEventListener(name, action)
    }
  }
}

window.customElements.define('wmm-audio', WmmAudio)</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="WmmAudio.html">WmmAudio</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Nov 19 2021 10:49:25 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
